(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{170:function(t,e,n){},218:function(t,e){},357:function(t,e){},360:function(t,e){},364:function(t,e){},365:function(t,e){},366:function(t,e){},367:function(t,e){},368:function(t,e){},456:function(t,e,n){"use strict";n.r(e);var i=n(166),a=n(51),r=(n(170),n(14),n(159)),o=n(25),c=n(94),s=n(3),u=n(459),l=n(460),p="https://cors.eu.org/https://app.jaicp.com/cailapub/api/caila/p/".concat(Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ASR_LANGUAGE:"ru-RU",REACT_APP_JAICP_TOKEN:"NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431",REACT_APP_SUBSCRIPTION_KEY:"2e15e033f605414bbbfe26cb631ab755",REACT_APP_TTS_VOICE:"Dariya"}).REACT_APP_CAILA,"/nlu/inference?query=");function d(t){return Object(s.q)((function(e){return{type:"SPEAK",value:t}}))}var f={initial:"idle",states:{idle:{on:{CLICK:"init"}},init:{on:{TTS_READY:"welcome",CLICK:"welcome"}},welcome:{initial:"prompt",on:{RECOGNISED:[{target:"supermarket",cond:function(t,e){return"\u0421\u0443\u043f\u0435\u0440\u043c\u0430\u0440\u043a\u0435\u0442."===t.recResult[0].utterance}},{target:".next"}],TIMEOUT:".."},states:{prompt:{entry:d("\u041f\u0440\u0438\u0432\u0435\u0442! \u0421\u043f\u0440\u043e\u0441\u0438 \u043c\u0435\u043d\u044f \u0447\u0442\u043e-\u043d\u0438\u0431\u0443\u0434\u044c."),on:{ENDSPEECH:"ask"}},ask:{entry:Object(s.q)("LISTEN")},next:{invoke:{id:"nlInput",src:function(t,e){return n=t.recResult[0].utterance,fetch(new Request(p+n,{method:"GET",headers:{Origin:"https://maraev.me/"}})).then((function(t){return t.json()}));var n},onDone:[{target:"napoleon",cond:function(t,e){return"/Answer:Napoleon"===e.data.intent.path}},{target:"nenapoleon"}]}},napoleon:{entry:d("\u041d\u0430\u043f\u043e\u043b\u0435\u043e\u043d!")},nenapoleon:{entry:d("\u041d\u0435 \u043d\u0430\u043f\u043e\u043b\u0435\u043e\u043d!")}}},supermarket:{initial:"prompt",states:{prompt:{entry:d("\u0412\u043e\u0442 \u0442\u044b \u043f\u0440\u0438\u0445\u043e\u0434\u0438\u0448\u044c \u0432 \u043c\u0430\u0433\u0430\u0437\u0438\u043d \u0438, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u044f - \u043f\u0440\u043e\u0434\u0430\u0432\u0435\u0446. \u0422\u044b \u0434\u043e\u043b\u0436\u0435\u043d \u0447\u0442\u043e-\u0442\u043e \u043a\u0443\u043f\u0438\u0442\u044c, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u043c\u0430\u043c\u0430 \u0438\u043b\u0438 \u043f\u0430\u043f\u0430 \u0442\u0435\u0431\u044f \u043f\u043e\u043f\u0440\u043e\u0441\u0438\u043b\u0438: \u0443 \u043d\u0430\u0441 \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0438\u0441\u044c \u0445\u043b\u0435\u0431 \u0438 \u043c\u043e\u043b\u043e\u043a\u043e, \u0441\u0445\u043e\u0434\u0438 \u043a\u0443\u043f\u0438 \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u0432 \u043c\u0430\u0433\u0430\u0437\u0438\u043d. \u0427\u0442\u043e \u0442\u044b \u0431\u0443\u0434\u0435\u0448\u044c \u0434\u0435\u043b\u0430\u0442\u044c?"),on:{ENDSPEECH:"ask"}},ask:{entry:Object(s.q)("LISTEN"),on:{RECOGNISED:"prompt2"}},prompt2:{entry:d("\u0423\u0433\u0443. \u0427\u0442\u043e \u0434\u0430\u043b\u044c\u0448\u0435?"),on:{ENDSPEECH:"ask2"}},ask2:{entry:Object(s.q)("LISTEN"),on:{RECOGNISED:"prompt3"}},prompt3:{entry:d("\u043d\u0443 \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c \u0432\u043e\u0442 \u044f \u043f\u0440\u043e\u0434\u0430\u0432\u0435\u0446, \u0434\u0430? \u0438 \u0435\u0441\u043b\u0438 \u0443 \u0442\u0435\u0431\u044f \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0434\u0435\u043d\u0435\u0433 \u0438 \u0442\u044b \u0432\u0437\u044f\u043b \u043c\u043e\u043b\u043e\u043a\u043e \u0434\u043e\u0440\u043e\u0436\u0435, \u0447\u0435\u043c \u0443 \u0442\u0435\u0431\u044f \u0435\u0441\u0442\u044c \u0434\u0435\u043d\u0435\u0433, \u0438 \u044f \u0433\u043e\u0432\u043e\u0440\u044e \u0443 \u0432\u0430\u0441 \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 15 \u0440\u0443\u0431\u043b\u0435\u0439. \u0427\u0442\u043e \u0442\u043e\u0433\u0434\u0430?"),on:{ENDSPEECH:"#root.dm.init"}}}},stop:{entry:d("Ok"),always:"init"},repaint:{initial:"prompt",states:{prompt:{on:{ENDSPEECH:"repaint"}},repaint:{entry:"changeColour",always:"#root.dm.welcome"}}}}},E=n(160),S=n.n(E),m=n(163),b=n.n(m),T=n(12),O=o.a.send,g=o.a.cancel,C="northeurope";Object(l.a)({url:"https://statecharts.io/inspect",iframe:!1});var h=Object(c.a)({id:"root",type:"parallel",states:{dm:Object(a.a)({},f),gui:{initial:"micOnly",states:{micOnly:{on:{SHOW_ALTERNATIVES:"showAlternatives"}},showAlternatives:{on:{SELECT:"micOnly"}}}},asrtts:{initial:"init",states:{init:{on:{CLICK:{target:"getToken",actions:[Object(s.b)({audioCtx:function(t){return new(window.AudioContext||window.webkitAudioContext)}}),function(t){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioCtx.createMediaStreamSource(e)}))}]}}},getToken:{invoke:{id:"getAuthorizationToken",src:function(t,e){return A()},onDone:{actions:[Object(s.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillASR"],target:"ponyfillTTS"},onError:{target:"fail"}}},ponyfillTTS:{invoke:{id:"ponyTTS",src:function(t,e){return function(e,n){var i=b()({audioContext:t.audioCtx,credentials:{region:C,authorizationToken:t.azureAuthorizationToken}}),a=i.speechSynthesis,r=i.SpeechSynthesisUtterance;t.tts=a,t.ttsUtterance=r,t.tts.addEventListener("voiceschanged",(function(){t.tts.cancel();var n=t.tts.getVoices(),i=RegExp("en-US","u");i=RegExp("Dariya","u");var a=n.find((function(t){return i.test(t.name)}));a?(t.voice=a,e("TTS_READY")):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(i)),e("TTS_ERROR"))}))}}},on:{TTS_READY:"idle",TTS_ERROR:"fail"}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(s.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(s.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",SELECT:"idle",CLICK:".pause"},states:{noinput:{entry:["recStart",O({type:"TIMEOUT"},{delay:function(t){return 1e3*(t.tdmPassivity||10)},id:"timeout"})],on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:g("timeout")},inprogress:{},match:{entry:O("RECOGNISED")},pause:{entry:"recStop",on:{CLICK:"noinput"}}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle",SELECT:"idle",CLICK:{target:"idle",actions:O("ENDSPEECH")}},exit:"ttsStop"},fail:{}}}}},{actions:{recLogResult:function(t){console.log("U>",t.recResult[0].utterance,t.recResult[0].confidence)},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),v=function(t){var e=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,n=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"image"===t.attribute}))||{}).value,i="circle";switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):break;case t.state.matches({asrtts:{recognising:"pause"}}):e="Click to continue";break;case t.state.matches({asrtts:"recognising"}):i="circle-recognising",e=e||"Listening...";break;case t.state.matches({asrtts:"speaking"}):i="circle-speaking",e=e||"Speaking...";break;case t.state.matches({dm:"idle"}):case t.state.matches({dm:"init"}):e="Click to start!",i="circle-click";break;default:e=e||"\xa0"}return Object(T.jsxs)("div",{className:"control",children:[Object(T.jsx)("figure",{className:"prompt",children:n&&Object(T.jsx)("img",{src:n,alt:e})}),Object(T.jsxs)("div",{className:"status",children:[Object(T.jsx)("button",Object(a.a)({type:"button",className:i,style:{}},t)),Object(T.jsx)("div",{className:"status-text",children:e})]})]})},j=function(t){var e=t.alternative.find((function(t){return"name"===t.attribute})).value,n=(t.alternative.find((function(t){return"image"===t.attribute}))||{}).value;return Object(T.jsxs)("figure",Object(a.a)(Object(a.a)({className:"flex"},t),{},{children:[n&&Object(T.jsx)("img",{src:n,alt:e}),Object(T.jsx)("figcaption",{children:e})]}))};function R(){var t=Object(u.b)(h,{devTools:!0,actions:{recStart:Object(u.a)((function(t){t.asr.start()})),recStop:Object(u.a)((function(t){t.asr.abort()})),ttsStart:Object(u.a)((function(t){var e=new t.ttsUtterance(t.ttsAgenda);console.log("S>",t.ttsAgenda),e.voice=t.voice,e.onend=function(){return a("ENDSPEECH")},t.tts.speak(e)})),ttsStop:Object(u.a)((function(t){t.tts.cancel()})),ponyfillASR:Object(u.a)((function(t,e){var n=S()({audioContext:t.audioCtx,credentials:{region:C,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;t.asr=new n,t.asr.lang="ru-RU",t.asr.continuous=!0,t.asr.interimResults=!0,t.asr.onresult=function(t){var e=t.results[0];e.isFinal?a({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):a({type:"STARTSPEECH"})}}))}}),e=Object(i.a)(t,2),n=e[0],a=e[1],r=(n.context.tdmExpectedAlternatives||[]).filter((function(t){return t.visual_information})).map((function(t,e){return Object(T.jsx)(j,{state:n,alternative:t.visual_information,onClick:function(){return a({type:"SELECT",value:t.semantic_expression})}},e)}));return Object(T.jsxs)("div",{className:"App",children:[Object(T.jsx)(v,{state:n,alternative:{},onClick:function(){return a("CLICK")}}),Object(T.jsx)("div",{className:"select-wrapper",children:Object(T.jsx)("div",{className:"select",children:r})})]})}var A=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"2e15e033f605414bbbfe26cb631ab755"}})).then((function(t){return t.text()}))},y=document.getElementById("root");r.render(Object(T.jsx)(R,{}),y)}},[[456,1,2]]]);
//# sourceMappingURL=main.2e646a25.chunk.js.map